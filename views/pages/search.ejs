<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
      integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link rel="stylesheet" href="/css/home.css" />
    <title>Search</title>
</head>
<body>
    <nav>
        <div class="container">
            <h1 class="logo">KUTEW</h1>
            <div class="page"><%= pageTitle %></div>
            <div class="search-barpage">
                <i class="fa-solid fa-magnifying-glass"></i>
                <input type="search" placeholder="Search" id="searchInput" />
            </div>
        </div>
    </nav>

    <main>
        <div class="container">
            <%- include('../includes/sidebar.ejs')%>
            <div class="middle-search">
                <div class="search-barpageinfo">
                    <i class="fa-solid fa-magnifying-glass searchicon"></i>
                    <input type="search" placeholder="Search" id="searchInputMiddle" />
                </div>
                <div class="tagsearch">
                    <div class="headtag-search"><i class="fa-solid fa-hashtag"></i> TAGS</div>
                    <a href="#">MATH I</a>
                    <a href="#">MATH II</a>
                </div>
                <div class="search-feed">
                    <div class="feeds" id="feedsContainer">
                        <!--  JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const searchInput = document.getElementById('searchInput');
            const searchInputMiddle = document.getElementById('searchInputMiddle');
            const feedsContainer = document.getElementById('feedsContainer');
        
            const performSearch = async (keyword) => {
                if (!keyword) {
                    feedsContainer.innerHTML = ''; // ล้างผลลัพธ์ถ้าคำค้นหาว่างเปล่า
                    return;
                }
        
                try {
                    const response = await fetch(`/post/search?keyword=${keyword}`);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const posts = await response.json();
        
                    feedsContainer.innerHTML = ''; // ล้างผลลัพธ์เก่า
        
                    posts.forEach(post => {
                        const postElement = document.createElement('div');
                        postElement.classList.add('feed');
        
                        const formattedDate = new Date(post.date).toISOString().split('T')[0];
                        
                        //default img
                        //const profilePic = post.profilePic ? post.profilePic : './img/boy.png';
                        postElement.innerHTML = `
                            <div class="head">
                                <div class="user">
                                    <div class="profile-photo">
                                        <img src="${post.tutor_profilePic}" alt="Profile Photo" />
                                    </div>
                                    <div class="info">
                                        <h3>${post.tutor_name}</h3>
                                        <small>${formattedDate}</small>
                                    </div>
                                </div>
                                <div class="icon-search">
                                    <i class="fa-regular fa-star"></i>
                                    <span>${post.request}</span>
                                </div>
                                <span class="join">
                                    <button class="btn btn-primary">JOIN</button>
                                </span>
                            </div>
                            <div class="caption">
                                <i class="fa-solid fa-book"><p>Tag:<p class="p-font">${post.tag}</p> </p></i>
                                <i class="fa-solid fa-newspaper"><p>Details:<p class="p-font">${post.details}</p> </p></i>
                                <i class="fa-solid fa-map-pin"><p>Lacation:<p class="p-font">${post.location}</p> </p></i>
                            </div>
                        `;
        
                        feedsContainer.appendChild(postElement);
                    });
                } catch (error) {
                    console.error('Error fetching search results:', error);
                }
            };
        
            // เพิ่ม Event Listener ให้กับช่องค้นหาทั้งสอง
            searchInput.addEventListener('input', (e) => performSearch(e.target.value));
            searchInputMiddle.addEventListener('input', (e) => performSearch(e.target.value));
        });
        
    </script>
</body>
</html>